/*!
 * PSPDFKit for Web 2020.3.0 (https://pspdfkit.com/web)
 * 
 * Copyright (c) 2016-2019 PSPDFKit GmbH. All rights reserved.
 * 
 * THIS SOURCE CODE AND ANY ACCOMPANYING DOCUMENTATION ARE PROTECTED BY INTERNATIONAL COPYRIGHT LAW
 * AND MAY NOT BE RESOLD OR REDISTRIBUTED. USAGE IS BOUND TO THE PSPDFKIT LICENSE AGREEMENT.
 * UNAUTHORIZED REPRODUCTION OR DISTRIBUTION IS SUBJECT TO CIVIL AND CRIMINAL PENALTIES.
 * This notice may not be removed from this file.
 * 
 * PSPDFKit uses several open source third-party components: https://pspdfkit.com/acknowledgements/web/
 */
(window.__PSPDFKitChunk=window.__PSPDFKitChunk||[]).push([[59],{730:function(t,e){},731:function(t,e,n){"use strict";n.d(e,"a",function(){return o});var r=n(147),a=n(5),i=n(3),s=n(233);function o(t){return Object(i.h)(Array.isArray(t),"Wrong `json` field"),Object(a.a)(t.map(function(t){if(Object(i.h)("number"==typeof t.pageIndex,"Wrong `pageIndex` field"),Object(i.h)("string"==typeof t.previewText,"Wrong `previewText` field"),Object(i.h)(Array.isArray(t.rangeInPreview),"Wrong `rangeInPreview` field"),Object(i.h)(Array.isArray(t.rectsOnPage),"Wrong `rectsOnPage` field"),!t.isAnnotation)return new s.a({pageIndex:t.pageIndex,previewText:t.previewText,locationInPreview:t.rangeInPreview[0],lengthInPreview:t.rangeInPreview[1],rectsOnPage:Object(a.a)(t.rectsOnPage).map(function(t){return Object(r.a)(t)})})}).filter(Boolean))}},732:function(t,e,n){"use strict";n.d(e,"a",function(){return d});var r=n(25),a=n.n(r),i=n(6),s=n.n(i),o=n(12),c=n.n(o),u=n(5),h=(n(454),n(3));function l(){return!0}var d=function(){function t(e){s()(this,t),this.queue=Object(u.c)(),this.priorityQueue=Object(u.c)(),this.inFlightRequests=Object(u.b)(),this.inflightRequestLimit=e,this.isDestroyed=!1}return c()(t,[{key:"enqueue",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isDestroyed)return{promise:new Promise(function(){}),cancel:function(){}};var r=null,a=null,i=new Promise(function(t,e){r=t,a=e}),s=n?this.priorityQueue:this.queue,o=Object(u.j)(s,t,{promise:i,resolve:r,reject:a});return n?this.priorityQueue=o:this.queue=o,n?this.next():setTimeout(function(){return e.next()},35),{promise:i,cancel:function(){return e._cancel(t)}}}},{key:"_cancel",value:function(t){this.queue.has(t)&&(this.queue=this.queue.delete(t)),this.priorityQueue.has(t)&&(this.priorityQueue=this.priorityQueue.delete(t)),this.inFlightRequests.has(t)&&(this.inFlightRequests=this.inFlightRequests.delete(t))}},{key:"cancelAll",value:function(){this.queue=Object(u.c)(),this.priorityQueue=Object(u.c)(),this.inFlightRequests=Object(u.b)()}},{key:"_requestFinished",value:function(t,e){if(!this.isDestroyed){var n=this.inFlightRequests.get(t);n&&(n.resolve(e),this.inFlightRequests=this.inFlightRequests.delete(t)),this.next()}}},{key:"_requestFailed",value:function(t,e){if(!this.isDestroyed){var n=this.inFlightRequests.get(t);n&&(n.reject(e),this.inFlightRequests=this.inFlightRequests.delete(t)),this.next()}}},{key:"next",value:function(){var t=this;if(!(this.isDestroyed||this.inFlightRequests.size>=this.inflightRequestLimit)){if(this.priorityQueue.size>=1){var e=this.priorityQueue.findLastEntry(l);Object(h.h)(e);var n=a()(e,2),r=n[0],i=n[1];return this.priorityQueue=this.priorityQueue.delete(r),this.inFlightRequests=this.inFlightRequests.set(r,i),void r.request().then(function(e){return t._requestFinished(r,e)}).catch(function(e){return t._requestFailed(r,e)})}if(this.queue.size>=1){var s=this.queue.findEntry(l);Object(h.h)(s);var o=a()(s,2),c=o[0],u=o[1];this.queue=this.queue.delete(c),this.inFlightRequests=this.inFlightRequests.set(c,u),c.request().then(function(e){return t._requestFinished(c,e)}).catch(function(e){return t._requestFailed(c,e)})}}}},{key:"destroy",value:function(){this.isDestroyed=!0}}]),t}()},733:function(t,e,n){"use strict";n.d(e,"a",function(){return o});var r=n(1),a=n.n(r),i=n(17),s=n.n(i);function o(t,e,n,r,i,o){var c;return t.has(n)?c=t.get(n):(e[c=i.toString()]=n,t.set(n,c)),s()({},r,a()({},o,c))}},806:function(t,e,n){"use strict";n.r(e);var r=n(17),a=n.n(r),i=n(57),s=n.n(i),o=n(13),c=n.n(o),u=n(19),h=n.n(u),l=n(31),d=n.n(l),f=n(6),p=n.n(f),m=n(12),v=n.n(m),g=n(1),y=n.n(g),w=n(3);function b(t,e,n){return k.apply(this,arguments)}function k(){return(k=h()(c.a.mark(function t(e,n,r){var a;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("".concat(e,"/auth"),{method:"POST",headers:{"Content-Type":"application/json","PSPDFKit-Platform":"web","PSPDFKit-Version":"protocol=".concat(3,", client=").concat("2020.3.0",", client-git=").concat("252a23fd44")},body:JSON.stringify({jwt:n.jwt,origin:window.location.href,password:r}),credentials:"include"});case 2:if(!(a=t.sent).ok){t.next=7;break}return t.abrupt("return",a.json());case 7:return t.abrupt("return",a.text().then(function(t){throw"INVALID_PASSWORD"===t?new w.a(t):new w.a("An error occurred while connecting to PSPDFKit Server: ".concat(t||a.statusText))}));case 8:case"end":return t.stop()}},t)}))).apply(this,arguments)}n(730);var _=n(2),P=n(24),x=n(358),S=n(179),j=n(22),O=n(195),R=n(5),F=n(15),q=n(731),I=n(147),D=n(32),T=n(129);n(454);var U=n(225),A=function(){function t(e,n){p()(this,t),this.identifier=this.url=e,this.token=n}return v()(t,[{key:"request",value:function(){var t=this;return new Promise(function(e,n){var r=new Image;t.placeholderImage=r,r.onload=function(){return e(new U.a(r,function(){}))},r.onerror=function(){return n()},r.src=t.url})}},{key:"abort",value:function(){this.placeholderImage&&this.placeholderImage.src&&(this.placeholderImage.src="")}}]),t}(),L=n(392),C=n(732),E=n(8),J=n.n(E),N=n(7),H=n.n(N),Q=n(9),K=n.n(Q),W=(n(274),function(t){function e(){return p()(this,e),J()(this,H()(e).apply(this,arguments))}return K()(e,t),e}(Object(R.e)({authPayload:null,serverUrl:null,documentId:null,backendPermissions:null,documentURL:null,imageToken:null,instantSettings:null,token:null,features:Object(R.a)(),isFormsEnabled:!0,minSearchQueryLength:1,documentHandle:null,isDocumentHandleOutdated:!1,digitalSignatures:null}))),B=n(82),V=n(393),z=n(180),M="The image can not be rendered because of an unknown error.",X=function(){function t(e,n,r,a){p()(this,t),this.identifier=e,this.url=n,this.token=r,this.payload=a}return v()(t,[{key:"abort",value:function(){this.httpRequest&&this.httpRequest.abort()}},{key:"request",value:function(){var t=this;return new Promise(function(e,n){var r=new XMLHttpRequest;t.httpRequest=r,r.open(t.payload?"POST":"GET",t.url,!0),r.setRequestHeader("X-PSPDFKit-Image-Token",t.token),z.b&&r.setRequestHeader("Accept","image/webp,*/*"),r.responseType="blob",r.onreadystatechange=function(){if(4===r.readyState){if(r.response&&r.response.type.startsWith("application/json")){var t=new FileReader;return t.onload=function(t){var r=JSON.parse(t.target.result);r.attachments_not_found?e({attachmentsNotFound:r.attachments_not_found}):r.error?n(new w.a("The server could not render the requested image (".concat(r.error,")"))):n(new w.a(M))},t.onerror=function(){return n(new w.a(M))},void t.readAsText(r.response)}if(Object(V.a)(r.status)){var a=r.response,i=URL.createObjectURL(a),s=new Image;s.onload=function(){var t=new U.a(s,function(){return URL.revokeObjectURL(i)});e(t)},s.onerror=function(){return n(new w.a(M))},s.src=i}else n(new w.a(M))}}.bind(t),r.send(t.payload)})}}]),t}(),G=n(122),Y=n(733),Z=n(396),$=n(344),tt=n(286);n.d(e,"default",function(){return et});var et=function(){function t(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window;p()(this,t),y()(this,"_password",null),y()(this,"type","SERVER"),y()(this,"_requestRenderAnnotation",function(t,e,r,a,i,s){var o,c,u="".concat(n._state.documentURL,"/render_annotation"),h="render-annotation-".concat(s?Object(G.a)():t.id),l=JSON.stringify({data:Object(D.o)(t),width:a,height:i,detached:s||void 0,formFieldValue:e?Object(D.s)(e):void 0}),d=!1,f=[],p=new Promise(function(t,e){o=t,c=e});return function e(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=new FormData;i.append("render",l),a.length>0&&t.imageAttachmentId&&r&&r.data&&i.append(t.imageAttachmentId,r.data);var s=new X(h,u,n._state.imageToken,i),p=n._requestQueue.enqueue(s,!1);p.promise.then(function(t){d||(t.attachmentsNotFound?e(t.attachmentsNotFound):t.attachmentsNotFound?c(new w.a("Attachment could not be found.")):o(t))}).catch(function(t){d||c(t)}),f.push(p)}(),{promise:p,cancel:function(){d=!0,f.forEach(function(t){return t.cancel()})}}}),y()(this,"handleDocumentHandleConflict",function(){n._state=n._state.set("isDocumentHandleOutdated",!0),n.cancelRequests(),n._destroyProvider()});var a=e.serverUrl||Object(S.a)(r.document);if("/"!==a.substr(-1))throw new w.a("`serverUrl` must have a slash at the end (e.g. `https://pspdfkit.example.com/`).");if(!e.serverUrl&&a==="".concat(r.location.protocol,"//").concat(r.location.host,"/"))throw new w.a('PSPDFKit automatically infers the URL of PSPDFKit Server from the current `<script>` tag.\nIn the current case, this URL is set to the same as the current browser\'s location.\nThis can happen when you bundle pspdfkit.js with your custom JavaScript for example.\n\nTo make sure everything works as expected, please set the `serverUrl` to the URL of PSPDFKit Server:\n\nPSPDFKit.load({\n  serverUrl: "https://pspdfkit-server.example.com/",\n  ...,\n});');if("string"!=typeof e.documentId)throw new w.a("`documentId` must be of type string.");if("object"!==d()(e.authPayload)||"string"!=typeof e.authPayload.jwt)throw new w.a("authPayload must be an object that contains the `jwt`. For example: `authPayload: { jwt: 'xxx.xxx.xxx'}`");!function(t){var e="The supplied JWT is invalid. Please refer to our guides on how to set up authentication:\n  https://pspdfkit.com/guides/web/current/server-backed/client-authentication/";if(-1===t.indexOf('{"internal":')){var n;Object(w.h)("string"==typeof t&&3===t.split(".").length,e);try{n=JSON.parse(atob(t.split(".")[1]))}catch(t){throw new w.a(e)}Object(w.h)("string"==typeof n.document_id,"The supplied JWT is invalid. The field 'document_id' has to be a string value.\n  Please refer to our guides for further information: https://pspdfkit.com/guides/web/current/server-backed/client-authentication/")}}(e.authPayload.jwt),function(t){var e="";if("boolean"!=typeof t&&(Object(w.i)(t)?(t.hasOwnProperty("clientsPresenceEnabled")&&"boolean"!=typeof t.clientsPresenceEnabled&&(e+="`clientsPresenceEnabled` in instance settings is not valid. Must be `true` or `false`.\n"),t.hasOwnProperty("listenToServerChangesEnabled")&&"boolean"!=typeof t.listenToServerChangesEnabled&&(e+="`listenToServerChangesEnabled` in instance settings is not valid. Must be `true` or `false`.\n")):e="`instant` flag must either be set to `true` or `false`\n",e))throw new w.a("".concat(e,"\nFor more information about PSPDFKit Instant please visit:\nhttps://pspdfkit.com/guides/web/current/instant/overview/"))}(e.instant);var i=null;if(e.instant)if(Object(w.i)(e.instant)){var s=e.instant;i={clientsPresenceEnabled:!1!==s.clientsPresenceEnabled,listenToServerChangesEnabled:!1!==s.listenToServerChangesEnabled}}else i=Z.a;this._requestQueue=new C.a(F.C),this._state=new W({serverUrl:a,documentId:e.documentId,instantSettings:i,documentURL:"".concat(a,"i/d/").concat(e.documentId),authPayload:e.authPayload,isFormsEnabled:!e.disableForms}),e.trustedCAsCallback&&Object(w.m)("PSPDFKit.Configuration#trustedCAsCallback is only used on Standalone deployments. On a Server-backed deployment, please follow the instructions at https://pspdfkit.com/guides/web")}var e,r,i,o,u,l,f,m,g,k,U,E,J,N,H,Q;return v()(t,[{key:"isUsingInstantProvider",value:function(){return null!=this._state.instantSettings}},{key:"hasClientsPresence",value:function(){var t=this._state.instantSettings;return null!=t&&!1!==t.clientsPresenceEnabled}},{key:"load",value:(Q=h()(c.a.mark(function t(e){var n,r,a,i,s,o,u,h,l,d,f=this;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b("".concat(this._state.serverUrl,"i/d/").concat(this._state.documentId),this._state.authPayload,e);case 2:if(n=t.sent,r=n.imageToken,a=n.token,i=n.permissions,s=n.features,o=n.hasPassword,u=n.minSearchQueryLength,h=n.layerHandle,l=n.allowedTileScales,d=n.digitalSignatures,this._password=e,!this._state.instantSettings||s.includes(_.y.INSTANT)){t.next=15;break}throw new w.a("Instant feature is not enabled on this server. Please set `instant` to `false`.\n\nFor more information about PSPDFKit Instant please visit:\nhttps://pspdfkit.com/guides/web/current/instant/overview/");case 15:return this._state=this._state.withMutations(function(t){return t.set("imageToken",r).set("token",a).set("features",Object(R.a)(s)).set("backendPermissions",new _.c({readOnly:-1===i.indexOf("write"),downloadingAllowed:i.indexOf("download")>=0})).set("documentURL","".concat(f._state.serverUrl,"i/d/").concat(f._state.documentId,"/h/").concat(h)).set("documentHandle",h).set("isDocumentHandleOutdated",!1).set("digitalSignatures",Object(D.g)(d))}),this.provider&&this.provider.destroy(),t.next=19,this._initProvider();case 19:return this.provider=t.sent,this._state.instantSettings&&this.provider.setDocumentHandleConflictCallback(this.handleDocumentHandleConflict),t.abrupt("return",{features:this._state.features,hasPassword:o,minSearchQueryLength:u,allowedTileScales:l,jsActionChanges:[]});case 22:case"end":return t.stop()}},t,this)})),function(t){return Q.apply(this,arguments)})},{key:"_initProvider",value:(H=h()(c.a.mark(function t(){var e,r,a,i,s,o;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._state.instantSettings){t.next=9;break}return e="".concat(this._state.serverUrl,"i/d/").concat(this._state.documentId,"/h/").concat(this._state.documentHandle),t.next=4,Promise.resolve().then(n.bind(null,727));case 4:return r=t.sent,a=r.InstantProvider,t.abrupt("return",new a("".concat(this._state.serverUrl,"i/d/").concat(this._state.documentId),e,{auth_token:this._state.token},this._state.instantSettings));case 9:return i=this._state.isFormsEnabled&&this._state.features.includes(_.y.FORMS),t.next=12,Promise.resolve().then(n.bind(null,453));case 12:return s=t.sent,o=s.RESTProvider,t.abrupt("return",new o(this._state.documentURL,{token:this._state.token},{isFormsEnabled:i}));case 15:case"end":return t.stop()}},t,this)})),function(){return H.apply(this,arguments)})},{key:"destroy",value:function(){this.provider&&this.provider.destroy(),this._requestQueue&&this._requestQueue.destroy()}},{key:"documentInfo",value:function(){return this._fetch("".concat(this._state.documentURL,"/document.json")).then(function(t){return t.json()}).then(function(t){return t.data.totalPages=t.data.pageCount,t.data})}},{key:"getFormJSON",value:function(){return this._fetch("".concat(this._state.documentURL,"/form.json")).then(function(t){return 403===t.status?{v:1,type:"pspdfkit/form",annotations:[],fields:[]}:t.json().then(function(t){return t.data})})}},{key:"evalFormValuesActions",value:(N=h()(c.a.mark(function t(){return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:throw new Error("not implemented");case 1:case"end":return t.stop()}},t)})),function(){return N.apply(this,arguments)})},{key:"evalScript",value:(J=h()(c.a.mark(function t(){return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:throw new Error("not implemented");case 1:case"end":return t.stop()}},t)})),function(){return J.apply(this,arguments)})},{key:"permissions",value:function(){return Promise.resolve(this._state.backendPermissions)}},{key:"textForPageIndex",value:function(t){var e="".concat(this._state.documentURL,"/page-").concat(t,"-text"),n=new(this._getJSONRequestHandler())(e,this._state.token),r=this._requestQueue.enqueue(n,!0);return{promise:r.promise.then(function(e){return Object(O.b)(e,t)}),cancel:function(){r.cancel()}}}},{key:"getTextFromRects",value:function(t,e){var n=encodeURIComponent(JSON.stringify(e.map(I.b).toArray()));return this._fetch("".concat(this._state.documentURL,"/page-").concat(t,"-highlighted?rects=").concat(n)).then(function(t){return t.json()}).then(function(t){return t.text})}},{key:"_getJSONRequestHandler",value:function(){return L.a}},{key:"renderTile",value:function(t,e,n,r,a){var i=this;if(this._state.isDocumentHandleOutdated)return{promise:new Promise(function(){}),cancel:function(){}};var s,o,c="".concat(this._state.documentURL,"/page-").concat(t,"-dimensions-").concat(e.width,"-").concat(e.height,"-tile-").concat(n.left,"-").concat(n.top,"-").concat(n.width,"-").concat(n.height).concat(r?"-print":""),u=e.width===n.width&&e.height===n.height,h=!1,l=!1,d=[],f=[],p=new Promise(function(t,e){s=t,o=e});return function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(a){var r=new FormData;r.append("data",JSON.stringify({annotations:a.annotations.filter(j.r).map(D.o).toJS().map(function(t){return{content:t}}),formFieldValues:a.formFieldValues.map(D.s).toJS(),formFields:a.formFields.map(D.r).toJS(),signatures:a.signatures||[]})),n.length>0&&n.forEach(function(t){var e=a.attachments.get(t);Object(w.h)(e&&e.data,"Attachment data could not be found."),r.append(t,e.data)}),e=new X(c,c,i._state.imageToken,r)}else e=new(i._getImageRequestHandler())(c,c,i._state.imageToken);f.push(e);var p=i._requestQueue.enqueue(e,u);p.promise.then(function(e){if(!h)return e.attachmentsNotFound&&!l?(l=!0,void t(e.attachmentsNotFound)):void(e.attachmentsNotFound?o(new w.a("Attachment could not be found.")):s(e))}).catch(function(t){h||o(t)}),d.push(p)}(),{promise:p,cancel:function(){h=!0,f.forEach(function(t){t.abort&&"function"==typeof t.abort&&t.abort()}),d.forEach(function(t){return t.cancel()})}}}},{key:"renderAnnotation",value:function(t,e,n,r,a){return this._requestRenderAnnotation(t,e,n,r,a)}},{key:"renderPageAPStreams",value:(E=h()(c.a.mark(function t(e,n,r,a,i){var s;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.renderTile(e,r.toObject(),new _.J(r).toObject(),!1,{annotations:a,formFieldValues:i.map(function(t){return new T.a({name:t.name,value:t.value})}),attachments:Object(R.b)(),formFields:i});case 2:return s=t.sent,t.t0=B.j,t.next=6,s.promise;case 6:return t.t1=t.sent,t.t2=r.width,t.t3=r.height,t.t4=a,t.t5=n,t.t6={imageHandle:t.t1,width:t.t2,height:t.t3,annotations:t.t4,scaleFactor:t.t5},t.abrupt("return",(0,t.t0)(t.t6));case 13:case"end":return t.stop()}},t,this)})),function(t,e,n,r,a){return E.apply(this,arguments)})},{key:"renderDetachedAnnotation",value:function(t,e,n,r){return this._requestRenderAnnotation(t,null,e,n,r,!0)}},{key:"getAttachment",value:(U=h()(c.a.mark(function t(e){var n;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this._fetch("".concat(this._state.documentURL,"/attachments/").concat(e));case 3:n=t.sent,t.t0=n.status,t.next=404===t.t0?7:200===t.t0?8:11;break;case 7:throw new w.a("Attachment not Found.");case 8:return t.next=10,n.blob();case 10:return t.abrupt("return",t.sent);case 11:throw new w.a("Bad Request.");case 12:t.next=17;break;case 14:throw t.prev=14,t.t1=t.catch(0),new w.a("Could not fetch attachment from PSPDFKit Server. ".concat(t.t1));case 17:case"end":return t.stop()}},t,this,[[0,14]])})),function(t){return U.apply(this,arguments)})},{key:"_getImageRequestHandler",value:function(){return"blink"===P.a&&P.b<60||"gecko"===P.a?A:X}},{key:"search",value:(k=h()(c.a.mark(function t(e,n,r){var a,i,s;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a="q=".concat(encodeURIComponent(e),"&start=").concat(n,"&limit=").concat(r),i="".concat(this._state.documentURL,"/search?").concat(a),t.next=4,new L.a(i,this._state.token).request();case 4:return s=t.sent,t.abrupt("return",Object(q.a)(s.data));case 6:case"end":return t.stop()}},t,this)})),function(t,e,n){return k.apply(this,arguments)})},{key:"searchAndRedact",value:(g=h()(c.a.mark(function t(e,n){var r,i,o,u,h,l,d,f,p,m,v;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=n.searchType,o=n.annotationPreset,u=n.searchInAnnotations,h=o.color,l=o.fillColor,d=o.outlineColor,f=s()(o,["color","fillColor","outlineColor"]),t.next=4,this._fetch("".concat(this._state.documentURL,"/redactions"),{method:"post",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({strategy:i,strategyOptions:(r={},y()(r,i,i===tt.a.PRESET?e.replace(/_/g,"-"):e),y()(r,"includeAnnotations",u),r),content:a()({color:h&&h.toHex(),fillColor:l&&l.toHex(),outlineColor:d&&d.toHex()},f)})});case 4:return p=t.sent,t.next=7,p.json();case 7:return m=t.sent,v=m.data,t.abrupt("return",Object(R.a)(v&&v.annotations?v.annotations.map(function(t){return $.a.fromJSON(t.id,t.content)}):[]));case 10:case"end":return t.stop()}},t,this)})),function(t,e){return g.apply(this,arguments)})},{key:"exportPDF",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.flatten,n=void 0!==e&&e,r=t.includeComments,a=void 0===r||r,i="".concat(this._state.documentURL,"/pdf?token=").concat(this._state.token,"&flatten=").concat(String(n),"&comments=").concat(String(a),"&render_ap_streams=").concat(String(!n));return fetch(i,{method:"GET",credentials:"include"}).then(function(t){return t.arrayBuffer()})}},{key:"exportXFDF",value:function(){return this._fetch("".concat(this._state.documentURL,"/document.xfdf")).then(function(t){return t.text()})}},{key:"exportInstantJSON",value:function(){return this._fetch("".concat(this._state.documentURL,"/instant.json")).then(function(t){return t.json()})}},{key:"getPDFURL",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeComments,e=void 0===t||t;return{promise:Promise.resolve("".concat(this._state.documentURL,"/pdf?token=").concat(this._state.token,"&flatten=true&comments=").concat(String(e))),revoke:function(){}}}},{key:"generatePDFObjectURL",value:function(){var t,e=this,n=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeComments,r=void 0===n||n,a=!1;return{promise:new Promise(function(n){e.exportPDF({flatten:!0,includeComments:r}).then(function(e){if(!a){var r=new Blob([e],{type:"application/pdf"});t=window.URL.createObjectURL(r),n(t)}})}),revoke:function(){t&&window.URL.revokeObjectURL(t),a=!0}}}},{key:"getDocumentOutline",value:(m=h()(c.a.mark(function t(){var e,n,r;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this._fetch("".concat(this._state.documentURL,"/outline.json")).then(function(t){return t.json()});case 3:n=t.sent,e=n.data,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),e={};case 10:return r=Array.isArray(e.outline)?e.outline:[],t.abrupt("return",Object(R.a)(r.map(x.a)));case 12:case"end":return t.stop()}},t,this,[[0,7]])})),function(){return m.apply(this,arguments)})},{key:"onKeystrokeEvent",value:function(){throw new Error("not implemented")}},{key:"applyOperationsAndReload",value:(f=h()(c.a.mark(function t(e){var n;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,rt(e);case 3:return n=t.sent,this._destroyProvider(),t.next=7,this._fetch("".concat(this._state.documentURL,"/apply-operations"),{method:"post",body:n,credentials:"include"});case 7:t.next=12;break;case 9:throw t.prev=9,t.t0=t.catch(0),new w.a("Applying operations failed: ".concat(t.t0));case 12:return t.abrupt("return",this.reloadDocument());case 13:case"end":return t.stop()}},t,this,[[0,9]])})),function(t){return f.apply(this,arguments)})},{key:"applyRedactionsAndReload",value:(l=h()(c.a.mark(function t(){return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this._destroyProvider(),t.next=4,this._fetch("".concat(this._state.documentURL,"/redact"),{method:"post",credentials:"include"});case 4:return t.abrupt("return",this.reloadDocument());case 7:throw t.prev=7,t.t0=t.catch(0),this.provider.load(),new w.a("Applying redactions failed: ".concat(t.t0));case 11:case"end":return t.stop()}},t,this,[[0,7]])})),function(){return l.apply(this,arguments)})},{key:"reloadDocument",value:(u=h()(c.a.mark(function t(){return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.load(this._password);case 3:return t.abrupt("return",t.sent);case 6:throw t.prev=6,t.t0=t.catch(0),new w.a("Reloading the document failed: ".concat(t.t0));case 9:case"end":return t.stop()}},t,this,[[0,6]])})),function(){return u.apply(this,arguments)})},{key:"exportPDFWithOperations",value:(o=h()(c.a.mark(function t(e){var n;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,rt(e);case 3:return n=t.sent,t.abrupt("return",this._fetch("".concat(this._state.documentURL,"/pdf-with-operations"),{method:"post",body:n,credentials:"include"}).then(function(t){return t.arrayBuffer()}));case 7:throw t.prev=7,t.t0=t.catch(0),new w.a("Exporting PDF with operations failed: ".concat(t.t0));case 10:case"end":return t.stop()}},t,this,[[0,7]])})),function(t){return o.apply(this,arguments)})},{key:"getSignaturesInfo",value:(i=h()(c.a.mark(function t(){return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._refreshSignaturesInfoPromise){t.next=3;break}return t.next=3,this._refreshSignaturesInfoPromise;case 3:return t.abrupt("return",this._state.digitalSignatures);case 4:case"end":return t.stop()}},t,this)})),function(){return i.apply(this,arguments)})},{key:"refreshSignaturesInfo",value:function(){var t=this;return this._refreshSignaturesInfoPromise?this._refreshSignaturesInfoPromise:(this._refreshSignaturesInfoPromise=new Promise(function(e,n){t._fetch("".concat(t._state.documentURL,"/signatures"),{method:"get",credentials:"include"}).then(function(t){return t.json()}).then(function(n){var r=n.data;t._state=t._state.set("digitalSignatures",Object(D.g)(r)),t._refreshSignaturesInfoPromise=null,e()}).catch(function(e){t._state=t._state.set("digitalSignatures",null),t._refreshSignaturesInfoPromise=null,n(e)})}),this._refreshSignaturesInfoPromise)}},{key:"signDocumentAndReload",value:(r=h()(c.a.mark(function t(e,n){var r,i;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,void 0===n||"object"===d()(n)){t.next=3;break}throw new w.a("Signing service data must be an object if specified.");case 3:return r={},e&&"placeholderSize"in e&&(r.signerDataSource={estimatedSignatureSize:e.placeholderSize}),e&&"flatten"in e&&(r.flatten=e.flatten),i=a()({},n?{signingToken:n.signingToken}:null,r),this._destroyProvider(),t.next=10,this._fetch("".concat(this._state.documentURL,"/sign"),{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(i),credentials:"include"});case 10:return t.next=12,this.reloadDocument();case 12:t.next=18;break;case 14:throw t.prev=14,t.t0=t.catch(0),this.provider.load(),new w.a("Adding digital signature failed: ".concat(t.t0.message||t.t0));case 18:case"end":return t.stop()}},t,this,[[0,14]])})),function(t,e){return r.apply(this,arguments)})},{key:"getDocumentHandle",value:function(){return this._state.documentHandle}},{key:"cancelRequests",value:function(){this._requestQueue.cancelAll()}},{key:"_destroyProvider",value:function(){this.provider._clients&&this.provider._clients.disconnect(),this.provider.destroy()}},{key:"_fetch",value:(e=h()(c.a.mark(function t(e,n){var r,i,s;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e,a()({},n,{headers:a()({"X-PSPDFKit-Token":this._state.token,"PSPDFKit-Platform":"web","PSPDFKit-Version":"protocol=".concat(3,", client=").concat("2020.3.0",", client-git=").concat("252a23fd44")},n&&n.headers)}));case 2:if((r=t.sent).ok){t.next=10;break}return t.next=6,nt(r);case 6:throw i=t.sent,i="object"===d()(i)?i.reason:i,s=i||"".concat(r.status," ").concat(r.statusText),new w.a(s);case 10:return t.abrupt("return",r);case 11:case"end":return t.stop()}},t,this)})),function(t,n){return e.apply(this,arguments)})},{key:"syncChanges",value:function(){return this.provider.syncChanges()}}]),t}();function nt(t){return t.clone().json().catch(function(){return t.text()})}function rt(t){return at.apply(this,arguments)}function at(){return(at=h()(c.a.mark(function t(e){var n,r,a,i,s;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={},r=new WeakMap,t.next=4,Promise.all(e.map(function(){var t=h()(c.a.mark(function t(e,a){var i,s,o,u,h,l;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("importDocument"!==e.type){t.next=6;break}return i=e.document,Object(w.h)(i instanceof File||i instanceof Blob,"Wrong `importDocument` operation `document` value: it must be a File or a Blob"),t.abrupt("return",Object(Y.a)(r,n,i,e,a,"document"));case 6:if("applyInstantJson"!==e.type){t.next=14;break}return s=e.instantJson,Object(w.h)("object"===d()(s)&&null!==s,"Wrong `applyInstantJson` operation `instantJson` value: it must be an object"),o=JSON.stringify(s),u=new Blob([o],{type:"application/json"}),t.abrupt("return",Object(Y.a)(r,n,u,e,a,"dataFilePath"));case 14:if("applyXfdf"!==e.type){t.next=19;break}return h=e.xfdf,Object(w.h)("string"==typeof h,"Wrong `applyXfdf` operation `xfdf` value: it must be a string"),l=new Blob([h],{type:"application/vnd.adobe.xfdf"}),t.abrupt("return",Object(Y.a)(r,n,l,e,a,"dataFilePath"));case 19:return t.abrupt("return",e);case 20:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()));case 4:for(s in a=t.sent,(i=new FormData).append("operations",JSON.stringify({operations:a})),n)i.append(s,n[s]);return t.abrupt("return",i);case 9:case"end":return t.stop()}},t)}))).apply(this,arguments)}}}]);